<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>小羅盤｜危機處理訓練系統</title>

<script src="https://cdn.tailwindcss.com"></script>

<link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700;900&display=swap" rel="stylesheet">

<style>
:root{
--bg:#D8DCDD;
--line:#C8C0BE;
--accent:#F6D494;
}
body{
background:var(--bg);
font-family:'Zen Maru Gothic', sans-serif;
}
.hard-shadow{
box-shadow:4px 4px 0 var(--line);
border:2px solid var(--line);
}
.page{display:none;min-height:100vh;}
.page.active{display:block;}
.title-font{font-weight:900;letter-spacing:-1px;}
.pill-search{
border-radius:9999px;
padding:12px 20px;
border:2px solid var(--line);
}
.month-scroll{
display:flex;
overflow-x:auto;
gap:12px;
}
.month{
min-width:100px;
padding:10px;
background:white;
border-radius:20px;
text-align:center;
cursor:pointer;
}
.timer{
font-weight:900;
color:red;
}
.bottom-btn{
position:fixed;
bottom:20px;
left:50%;
transform:translateX(-50%);
width:90%;
max-width:500px;
padding:16px;
background:var(--accent);
font-weight:900;
border-radius:20px;
}
</style>
</head>

<body class="pb-24">

<nav id="top-nav" class="hidden sticky top-0 bg-white/80 backdrop-blur p-4 flex items-center border-b">
<button onclick="goBack()" class="hard-shadow px-3 py-1 bg-white">←</button>
<span id="nav-title" class="ml-4 font-black"></span>
</nav>

<!-- 首頁 -->
<div id="home" class="page active p-6">
<h1 class="text-4xl title-font mb-6">小羅盤</h1>

<div class="grid grid-cols-2 gap-4">

<div class="col-span-2 bg-[#F6D494] p-6 rounded-3xl hard-shadow cursor-pointer"
onclick="openPage('daily','今日日程')">
<h2 class="title-font">LIVE SCHEDULE</h2>
<div id="live-task" class="text-2xl mt-2"></div>
</div>

<div class="bg-white p-5 rounded-3xl hard-shadow cursor-pointer"
onclick="openPage('yearly','年度行程')">年度行程</div>

<div class="bg-white p-5 rounded-3xl hard-shadow cursor-pointer"
onclick="openPage('crisis','危機處理')">危機處理</div>

<div class="bg-white p-5 rounded-3xl hard-shadow cursor-pointer"
onclick="openPage('resources','資源外聯')">資源外聯</div>

<div class="bg-white p-5 rounded-3xl hard-shadow cursor-pointer"
onclick="openPage('parents','紅綠燈檔案')">紅綠燈檔案</div>

</div>

<div class="mt-8">
<input placeholder="搜尋家長/學生..."
class="pill-search w-full"
oninput="searchParents(this.value)">
</div>

</div>

<!-- 年度行程 -->
<div id="yearly" class="page p-6">
<div class="month-scroll mb-6">
<script>
for(let i=1;i<=12;i++){
document.write(`<div class="month hard-shadow"> ${i} 月 </div>`)
}
</script>
</div>
<div>（此區可自行編輯行程內容）</div>
</div>

<!-- 日程 -->
<div id="daily" class="page p-6">
<h2 class="title-font text-2xl mb-4">現在該做什麼？</h2>
<div id="daily-content"></div>
</div>

<!-- 危機處理 -->
<div id="crisis" class="page p-6 space-y-4">

<div class="bg-white p-6 rounded-2xl hard-shadow cursor-pointer"
onclick="openPage('query','查詢回覆')">
查詢如何回覆家長
</div>

<div class="bg-[#F6D494] p-6 rounded-2xl hard-shadow cursor-pointer"
onclick="openPage('quiz-category','情境練習')">
恐龍家長情境練習
</div>

<div class="bg-white p-6 rounded-2xl hard-shadow cursor-pointer"
onclick="openPage('help','真人協助')">
尋求真人協助
</div>

</div>

<!-- 情境分類 -->
<div id="quiz-category" class="page p-6 space-y-4">
<div onclick="startQuiz()" class="hard-shadow p-4 bg-white rounded-xl cursor-pointer">
學費問題
</div>
<div onclick="startQuiz()" class="hard-shadow p-4 bg-white rounded-xl cursor-pointer">
課程質疑
</div>
</div>

<!-- Quiz -->
<div id="quiz" class="page p-6">
<div class="flex justify-between">
<span id="progress"></span>
<span class="timer" id="timer"></span>
</div>
<div id="question" class="mt-6 font-bold"></div>
<div id="options" class="mt-4 space-y-3"></div>
</div>

<!-- 真人協助 -->
<div id="help" class="page p-6 space-y-4">
<input id="email" placeholder="電子信箱" class="w-full p-3 border rounded">
<textarea id="help-text" placeholder="請輸入問題"
class="w-full p-3 border rounded"></textarea>
<input type="file" id="photo">
<button onclick="submitHelp()" class="bottom-btn hard-shadow">
送出求助
</button>
</div>

<!-- 紅綠燈 -->
<div id="parents" class="page p-6">
<div id="parent-list"></div>
<button onclick="addParent()" class="bottom-btn hard-shadow">
＋ 新增檔案
</button>
</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
apiKey:"YOUR_KEY",
authDomain:"YOUR_DOMAIN",
projectId:"YOUR_PROJECT_ID"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

window.addParent = async function(){
const name=prompt("學生姓名");
const color=prompt("red/yellow/green");
await addDoc(collection(db,"parents"),{name,color});
loadParents();
}

async function loadParents(){
const snap=await getDocs(collection(db,"parents"));
let html="";
snap.forEach(d=>{
const p=d.data();
html+=`
<div class="hard-shadow p-4 bg-white mb-3 rounded-xl">
${p.name} (${p.color})
<button onclick="deleteParent('${d.id}')">刪除</button>
</div>`
});
document.getElementById("parent-list").innerHTML=html;
}
window.deleteParent=async function(id){
await deleteDoc(doc(db,"parents",id));
loadParents();
}
loadParents();
</script>

<script>
let historyStack=["home"];
function openPage(id,title){
document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
document.getElementById(id).classList.add("active");
document.getElementById("top-nav").classList.remove("hidden");
document.getElementById("nav-title").innerText=title||"";
historyStack.push(id);
}
function goBack(){
historyStack.pop();
const prev=historyStack.pop();
openPage(prev);
}

function tick(){
const h=new Date().getHours();
const task=h<17?"接車點名":h<19?"英文課輔":"準備結帳";
document.getElementById("live-task").innerText=task;
document.getElementById("daily-content").innerText=task;
}
tick();
setInterval(tick,60000);

/* Quiz */
const quizData=[
{q:"可以打折嗎？",o:["直接拒絕","詢問主管","強調價值"],a:2},
{q:"為何孩子在玩？",o:["每人不同","多派作業","說明理念"],a:2}
];
let qi=0,score=0,timeLeft=10,interval;

function startQuiz(){
qi=0;score=0;
openPage("quiz","情境練習");
nextQ();
}

function nextQ(){
if(qi>=quizData.length){
alert("完成！得分:"+score);
return goBack();
}
const q=quizData[qi];
document.getElementById("progress").innerText=(qi+1)+"/"+quizData.length;
document.getElementById("question").innerText=q.q;
let optHTML="";
q.o.forEach((t,i)=>{
optHTML+=`<div class="hard-shadow p-3 bg-white cursor-pointer"
onclick="selectOpt(${i})">${t}</div>`;
});
document.getElementById("options").innerHTML=optHTML;
timeLeft=10;
document.getElementById("timer").innerText=timeLeft;
interval=setInterval(()=>{
timeLeft--;
document.getElementById("timer").innerText=timeLeft;
if(timeLeft<=0){clearInterval(interval);qi++;nextQ();}
},1000);
}

function selectOpt(i){
clearInterval(interval);
if(i===quizData[qi].a)score+=10;
qi++;
nextQ();
}

function searchParents(keyword){
const cards=document.querySelectorAll("#parent-list div");
cards.forEach(c=>{
c.style.display=c.innerText.includes(keyword)?"block":"none";
});
}

function submitHelp(){
alert("已送出（示範版）");
}
</script>

</body>
</html>
